<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventori RSES - Skala Penghargaan Kendiri</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    h1, h2 { text-align: center; }
    .item { margin-bottom: 20px; }
    .options label { display: block; }
    button { padding: 10px 20px; font-size: 16px; }
    .result { margin-top: 30px; padding: 20px; border: 1px solid #ccc; background: #f9f9f9; }
  </style>
</head>
<body>
  <h1>Inventori RSES</h1>
  <p>Sila jawab setiap kenyataan berdasarkan skala berikut:</p>
  <ul>
    <li>0 – Sangat tidak setuju</li>
    <li>1 – Tidak setuju</li>
    <li>2 – Setuju</li>
    <li>3 – Sangat setuju</li>
  </ul>

  <form id="rsesForm">
    <div id="items"></div>
    <button type="submit">Hantar</button>
  </form>

  <div class="result" id="result" style="display:none;"></div>

  <script>
    const webhookURL = "https://script.google.com/macros/s/AKfycbxq7okJm-H2eBlWIlKRSa5GY_ebv6S1gEiZYUjDK-NZZbhY9GgGP6tT8ND8XI3GdZbBtQ/exec";

    const items = [
      "Saya fikir saya merupakan seorang yang bernilai, sama seperti orang lain.",
      "Saya fikir diri saya mempunyai beberapa ciri nilai kebaikan.",
      "Keseluruhannya, saya fikir bahawa saya cenderung untuk mengalami kegagalan.",
      "Saya boleh melakukan sesuatu dengan baik sama seperti orang lain.",
      "Saya fikir saya tidak mempunyai banyak perkara yang boleh dibanggakan.",
      "Saya menunjukkan sikap yang positif terhadap diri saya.",
      "Secara keseluruhannya, saya berpuas hati dengan diri saya.",
      "Saya berharap saya akan lebih menghargai diri sendiri.",
      "Kadang-kala saya merasa saya tidak berguna.",
      "Selalunya saya berfikir saya bukanlah individu yang baik keseluruhannya."
    ];

    const reverseItems = [2, 4, 7, 8, 9]; // item 3, 5, 8, 9, 10 (index bermula 0)
    const container = document.getElementById('items');

    items.forEach((text, i) => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `<p><strong>${i+1}.</strong> ${text}</p>
        <div class="options">
          <label><input type="radio" name="item${i}" value="0" required> 0 – Sangat tidak setuju</label>
          <label><input type="radio" name="item${i}" value="1"> 1 – Tidak setuju</label>
          <label><input type="radio" name="item${i}" value="2"> 2 – Setuju</label>
          <label><input type="radio" name="item${i}" value="3"> 3 – Sangat setuju</label>
        </div>`;
      container.appendChild(div);
    });

    document.getElementById('rsesForm').addEventListener('submit', function(e) {
      e.preventDefault();
      let total = 0;
      const responses = [];

      for (let i = 0; i < items.length; i++) {
        const val = parseInt(document.querySelector(`input[name=item${i}]:checked`).value);
        const score = reverseItems.includes(i) ? 3 - val : val;
        total += score;
        responses.push(val);
      }

      let tahap = '';
      if (total <= 15) tahap = 'Rendah';
      else if (total <= 25) tahap = 'Sederhana';
      else tahap = 'Tinggi';

      // Simpan ke localStorage
      localStorage.setItem("rses_last_result", JSON.stringify({ responses, total, tahap, timestamp: new Date().toISOString() }));

      // Hantar ke Google Sheets
      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ skor: total, tahap: tahap, jawapan: responses })
      })
      .then(res => res.text())
      .then(data => {
        alert("Jawapan anda berjaya dihantar ke Google Sheets!");
        console.log("Disimpan ke Google Sheets:", data);
      })
      .catch(err => {
        alert("Ralat semasa menghantar ke Google Sheets: " + err.message);
        console.error("Ralat penghantaran:", err);
      });

      // Papar keputusan
      const resultDiv = document.getElementById('result');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = `<h2>Keputusan Anda</h2>
        <p><strong>Skor:</strong> ${total} / 30</p>
        <p><strong>Tahap Penghargaan Kendiri:</strong> ${tahap}</p>
        <p><a href="https://chat.openai.com/" target="_blank">Klik di sini untuk dapatkan sokongan lanjut</a></p>`;
    });
  </script>
</body>
</html>
